asyncapi: 3.0.0
info:
  title: Async API for redispatching
  version: '0.0.1'
  description: |
    Specyfikacja asynchronicznego API na potrzeby redysponowania 
defaultContentType: application/json

servers:
  amqp-cluster:
    host: "${PSE_AMQP}"
    protocol: amqps
    protocolVersion: '1.0'
    description: B2B AMQP broker
    security:
      - $ref: '#/components/securitySchemes/oauth2'
    bindings:
      amqp:
        vhost: '/'
        heartbeat: 30
        locale: pl-PL
        tls: true
        bindingVersion: '0.3.0'

channels:
  redispatch.order.{entityId}:
    address: redispatch.order.{entityId}
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał z poleceniami redysponowania dla danego podmiotu (OSD lub przedstawiciela MWE przyłączonego do sieci przesyłowej - MWEp)
    parameters:
      entityId:
        description: Unikalny 5-znakowy identyfikator podmiotu.
        location: $message.payload#/header/entityId
    messages:
      RedispatchOrderMessage:
        $ref: '#/components/messages/RedispatchOrder'
    bindings:
      amqp:
        is: queue
        queue:
          name: redispatch.order.{entityId}
          durable: true
          exclusive: false
          autoDelete: false
        bindingVersion: '0.3.0'

  redispatch.acknowledgement:
    address: redispatch.acknowledgement
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał z odpowiedziami na polecenia redysponowania
    messages:
      RedispatchAcknowledgementMessage:
        $ref: '#/components/messages/RedispatchAcknowledgement'
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: redispatch
          type: topic
        bindingVersion: '0.3.0'

  redispatch.information.{entityId}:
    address: redispatch.information.{entityId}
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał z informacjami o zaplanowanych redysponowaniach
    parameters:
      entityId:
        description: Unikalny 5-znakowy identyfikator podmiotu.
        location: $message.payload#/header/entityId
    messages:
      RedispatchInformationMessage:
        $ref: '#/components/messages/RedispatchInformation'
    bindings:
      amqp:
        is: queue
        queue:
          name: redispatch.information.{entityId}
          durable: true
          exclusive: false
          autoDelete: false
        bindingVersion: '0.3.0'

  redispatch.failed:
    address: redispatch.failed
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał typu DLQ dla komunikatów redysponowania od OSP, które nie mogły zostać przetworzone z przyczyn technicznych przez podmioty
    messages:
      GenericFailureMessage:
        $ref: '#/components/messages/GenericFailure'
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: validation
          type: topic
        bindingVersion: '0.3.0'

  redispatch.failure.{entityId}:
    address: redispatch.failure.{entityId}
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał typu DLQ dla komunikatów redysponowania od podmiotów, które nie mogły zostać przetworzone z przyczyn technicznych przez OSP
    messages:
      GenericFailureMessage:
        $ref: '#/components/messages/GenericFailure'
    bindings:
      amqp:
        is: queue
        queue:
          name: redispatch.failure.{entityId}
          durable: true
          exclusive: false
          autoDelete: false
        bindingVersion: '0.3.0'
                     
  redispatch.dsoredispatches:
    address: redispatch.dsoredispatches    
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do wysyłania informacji o wydanych przez OSD poleceniach redysponowania w związku z wydanymi przez OSP poleceniami redysponowania    
    messages:      
      PsdiRedispatchRealizationMessage:
        $ref: '#/components/messages/PsdiRedispatchRealizationMessage'    
    bindings:
      amqp:        
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: psdi
          type: topic
        bindingVersion: '0.3.0'      
  
  redispatch.request-status.{entityId}:
    address: redispatch.request-status.{entityId}
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do odbioru potwierdzenia przetworzenia informacji przekazanych kanałem B2B
    messages:
      PsdiRequestStatusMessage:
        $ref: '#/components/messages/PsdiRedispatchRealizationResult'
    bindings:
      amqp:
        is: queue
        queue:
          name: redispatch.request-status.{entityId}
          durable: true
          exclusive: false
          autoDelete: false
        bindingVersion: '0.3.0'
  
  redispatch.networkcontraints:      
    address: redispatch.networkcontraints    
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do wysyłania informacji o ograniczeniach w sieci OSD niezwiązanych z wydanym poleceniem OSP
    messages:      
      PsdiRestrictionsMessage:
        $ref: '#/components/messages/PsdiRestrictionsMessage'    
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: psdi
          type: topic
        bindingVersion: '0.3.0'
        
  redispatch.generatedenergywithsupport:      
    address: redispatch.generatedenergywithsupport
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do wysyłania informacji o E_wyk_cert dla MWE, które były redysponowane przez OSD w związku z wydanym poleceniem OSP
    messages:      
      PsdiEWykCertMessage:
        $ref: '#/components/messages/PsdiEwykCertMessage'    
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: psdi
          type: topic
        bindingVersion: '0.3.0'
  
  redispatch.auctionsupportrequest:
    address: redispatch.auctionsupportrequest
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do wysyłania do OSP informacji o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, , które złożyli Wytwórcy w aplikacji WOZE po wydanym poleceniu przez OSP
    messages:      
      PsdiUOzeMessage:
        $ref: '#/components/messages/PsdiUOzeMessage'    
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: psdi
          type: topic
        bindingVersion: '0.3.0'
        
  redispatch.auctionsupportrequest.{entityId}:
    address: redispatch.auctionsupportrequest.{entityId}
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do wysyłania do OSD informacji o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, , które złożyli Wytwórcy poza aplikacją WOZE po wydanym poleceniu przez OSP
    messages:      
      PsdiUOzeMessage:
        $ref: '#/components/messages/PsdiUOzeMessage'    
    bindings:
      amqp:
        is: queue
        queue:
          name: redispatch.auctionsupportrequest.{entityId}
          durable: true
          exclusive: false
          autoDelete: false
        bindingVersion: '0.3.0'    
        
  redispatch.responsiblesubjectforgenerator:
    address: redispatch.responsiblesubjectforgenerator
    servers:
      - $ref: '#/servers/amqp-cluster'
    description: Kanał do przekazania do OSP informacji o zmianie przypisania POB do pojedynczego MWE
    messages:      
      PsdiPOBMessage:
        $ref: '#/components/messages/PsdiPOBMessage'    
    bindings:
      amqp:
        is: routingKey
        exchange:
          vhost: /
          autoDelete: false
          durable: true
          name: psdi
          type: topic
        bindingVersion: '0.3.0'      

operations:
  receiveRedispatchOrder:
    title: Odebranie przez podmiot polecenia redysponowania 
    action: receive
    channel:
      $ref: '#/channels/redispatch.order.{entityId}'
    summary: Odebranie przez podmiot polecenia redysponowania 
    messages:
      - $ref: '#/channels/redispatch.order.{entityId}/messages/RedispatchOrderMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'

  sendRedispatchAcknowledgement:
    title: Wysłanie przez podmiot potwierdzenia na polecenie redysponowania
    action: send
    channel:
      $ref: '#/channels/redispatch.acknowledgement'
    summary: Wysłanie przez podmiot potwierdzenia  na polecenie redysponowania
    messages:
      - $ref: '#/channels/redispatch.acknowledgement/messages/RedispatchAcknowledgementMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'

  receiveRedispatchInformation:
    title: Odebranie przez podmiot informacji o redysponowaniu
    action: receive
    channel:
      $ref: '#/channels/redispatch.information.{entityId}'
    summary: Odebranie przez podmiot informacji o redysponowaniu
    messages:
      - $ref: '#/channels/redispatch.information.{entityId}/messages/RedispatchInformationMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'

  sendGenericFailureMessage:
    title: Wysłanie przez podmiot informacji o błędnym komunikacie z OSP
    action: send
    channel:
      $ref: '#/channels/redispatch.failed'
    summary: Wysłanie przez podmiot informacji o błędnym komunikacie z OSP
    messages:
      - $ref: '#/channels/redispatch.failed/messages/GenericFailureMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'

  receiveGenericFailureMessage:
    title: Odebranie przez podmiot informacji o błednym komunikacie z podmiotu
    action: receive
    channel:
      $ref: '#/channels/redispatch.failure.{entityId}'
    summary: Odebranie przez podmiot informacji o błednym komunikacie z podmiotu
    messages:
      - $ref: '#/channels/redispatch.failed/messages/GenericFailureMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'   
      
  sendDSORedispatches:
    title: Operacja wysłania informacji o wydanych przez OSD poleceniach redysponowania na skutek polecenia OSP
    action: send
    channel:
      $ref: '#/channels/redispatch.dsoredispatches'
    summary: Nadanie komunikatu z informacją o wydanych poleceniach redysponowania
    messages:
      - $ref: '#/channels/redispatch.dsoredispatches/messages/PsdiRedispatchRealizationMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'      
      
  receiveRequest-status:
    title: Operacja odbioru potwierdzenia przetworzenia informacji przesłanych do OSP
    action: receive
    channel:
      $ref: '#/channels/redispatch.request-status.{entityId}'
    summary: Odebranie komunikatu potwierdzenia  przetworzenia informacji przesłanych do OSP
    messages:
      - $ref: '#/channels/redispatch.request-status.{entityId}/messages/PsdiRequestStatusMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'    
  
  sendDispatchNetworkContraints:
    title: Operacja wysłania informacji o ograniczeniach w sieci OSD niewydanych przez OSD poleceniach redysponowania na skutek polecenia OSP
    action: send
    channel:
      $ref: '#/channels/redispatch.networkcontraints'
    summary: Nadanie komunikatu z informacją o wydanych poleceniach redysponowania
    messages:
      - $ref: '#/channels/redispatch.networkcontraints/messages/PsdiRestrictionsMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'  
      
  sendGeneratedEnergyWithSupport:
    title: Operacja wysłania informacji o E_wyk_cert dla MWE, które były redysponowane przez OSD w związku z wydanym poleceniem OSP
    action: send
    channel:
      $ref: '#/channels/redispatch.generatedenergywithsupport'
    summary: Nadanie komunikatu z informacją o E_wyk_cert
    messages:
      - $ref: '#/channels/redispatch.generatedenergywithsupport/messages/PsdiEWykCertMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'
      
  sendAuctionSupportRequest:
    title: Operacja wysłania informacji o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, które złożyli Wytwórcy poza aplikacją WOZE po wydanym poleceniu przez OSP
    action: send
    channel:
      $ref: '#/channels/redispatch.auctionsupportrequest'
    summary: Nadanie komunikatu z informacją o zgłoszeniach uOze
    messages:
      - $ref: '#/channels/redispatch.auctionsupportrequest/messages/PsdiUOzeMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'    
      
  receiveAuctionSupportRequest:
    title: Operacja pobrania informacji o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, które złożyli Wytwórcy w aplikacji WOZE po wydanym poleceniu przez OSP
    action: receive
    channel:
      $ref: '#/channels/redispatch.auctionsupportrequest.{entityId}'
    summary: Pobranie komunikatu z informacją o zgłoszeniach uOze
    messages:
      - $ref: '#/channels/redispatch.auctionsupportrequest.{entityId}/messages/PsdiUOzeMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'
      
  sendResponsibleSubjectForGenerator:
    title: Operacja wysłania informacji o zmianie przypisania POB do pojedynczego MWE
    action: send
    channel:
      $ref: '#/channels/redispatch.responsiblesubjectforgenerator'
    summary: Nadanie komunikatu z informacją o zgłoszeniach uOze
    messages:
      - $ref: '#/channels/redispatch.responsiblesubjectforgenerator/messages/PsdiPOBMessage'
    security:
      - $ref: '#/components/securitySchemes/oauth2'

components:
  messages:
    RedispatchOrder:
      name: Polecenie redysponowania
      title: Polecenie redysponowania
      contentType: application/json
      payload:
        $ref: '#/components/schemas/RedispatchOrder'
      correlationId:
        description: Korelacja na podstawie tsoMsgId z nagłówka.
        location: $message.payload#/header/tsoMsgId

    RedispatchAcknowledgement:
      name: Potwierdzenie do wydanego polecenie redysponowania
      title: Potwierdzenie do wydanego polecenie redysponowania
      contentType: application/json
      payload:
        $ref: '#/components/schemas/RedispatchAcknowledgement'
      correlationId:
        description: Korelacja na podstawie tsoMsgId z nagłówka.
        location: $message.header#/tsoMsgId

    RedispatchInformation:
      name: Informacja o redysponowaniu
      title: Informacja o redysponowaniu
      contentType: application/json
      payload:
        $ref: '#/components/schemas/RedispatchInformation'
      correlationId:
        description: Korelacja na podstawie tsoMsgId z nagłówka.
        location: $message.payload#/header/tsoMsgId

    GenericFailure:
      name: Komunikat o błędzie przetwarzania
      title: Komunikat o błędzie przetwarzania
      contentType: application/json
      payload:
        $ref: '#/components/schemas/GenericFailure'
      correlationId:
        description: Korelacja na podstawie tsoMsgId lub entityMsgId z nagłówka.
        location: $message.payload#/refMsgId
    
    PsdiRedispatch:
      name: Informacja o wydanych poleceniach redysponowania
      title: Informacja o wydanych poleceniach redysponowania
      contentType: application/json      
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiRedispatch'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId  

    PsdiRedispatchRealizationMessage:
      name: Informacja o wydanych poleceniach redysponowania
      title: Informacja o wydanych poleceniach redysponowania
      contentType: application/json
      headers:
        $ref: '#/components/schemas/PsdiRedispatchHeader'
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiRedispatchRealization'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId

    PsdiUOzeMessage:
      name: Informacja o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, , które złożyli Wytwórcy w aplikacji WOZE po wydanym poleceniu przez OSP
      title: Informacja o zgłoszeniach uOze
      contentType: application/json
      headers:
        $ref: '#/components/schemas/PsdiRedispatchHeader'
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiUOze'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId

    PsdiPOBMessage:
      name: Informacja  o zmianie przypisania POB do pojedynczego MWE
      title: Informacja o POB
      contentType: application/json
      headers:
        $ref: '#/components/schemas/PsdiRedispatchHeader'
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiPOB'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId

    PsdiEwykCertMessage:
      name: Informacja o E_wyk_cert dla MWE, które były redysponowane przez OSD w związku z wydanym poleceniem OSP
      title: Informacja o E_wyk_cert
      contentType: application/json
      headers:
        $ref: '#/components/schemas/PsdiRedispatchHeader'
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiEWykCert'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId

    PsdiRestrictionsMessage:
      name: Informacja o ograniczeniach w sieci OSD nie związanych z wydanym przez OSP poleceniem redysponowania
      title: Informacja o ograniczeniach w sieci OSD
      contentType: application/json
      headers:
        $ref: '#/components/schemas/PsdiRedispatchHeader'      
      payload:
        type: array
        items: 
          $ref: '#/components/schemas/PsdiRestrictions'      
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.header#/serverMsqId

    PsdiRedispatchRealizationResult:
      name: Informacja o przetworzeniu informacji o wydanym przez OSD pocelceniu redysponowania
      title: Informacja o przetworzeniu informacji o wydanym przez OSD pocelceniu redysponowania
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PsdiMessageResult'
      correlationId:
        description: Korelacja na podstawie serverMsqId z nagłówka.
        location: $message.payload#/serverMsqId

  schemas:
    BaseHeader:
      type: object
      additionalProperties: false
      required:
        - tsoMsgId
        - creationDateTime
        - stdVersion
      properties:
        tsoMsgId:
          type: string
          description: "identyfikator komunikatu nadawany przez OSP"
          format: uuid
          examples:
            - d0443a92-f807-45f0-867e-70cf5321dec7
        creationDateTime:
          type: string
          format: date-time
          description: "Data utworzenia komunikatu. Data i czas w formacie YYYY-MM-DDThh:mm:ss, podawana w czasie UTC "
          pattern: 'Z$'
          examples:
            - 2002-09-24T12:21:47Z
        stdVersion:
          type: string
          description: "Wersja standardów B2B"
          minLength: 3
          maxLength: 3

    RedispatchOrder:
      type: object
      additionalProperties: false
      required:
        - header
        - redispatchOrderPeriod
        - redispatchOrder
      properties:
        header:
          allOf:
            - $ref: '#/components/schemas/BaseHeader'
            - type: object
              required:
                - entityId
                - type
                - redispatchOrderCode
                - redispatchOrderReason
              properties:
                entityId:
                  type: string
                  description: "Identyfikator podmiotu (OSDp, Wytwórcy przyłączonego do Sieci Przesyłowej), który odpowiada za realizację polecenia redysponowania. Identyfikator zgodny z bazą Partnerów Biznesowych PSE."
                  minLength: 5
                  maxLength: 5
                type:
                  type: string
                  description: "Typ komunikatu. Dopuszczalna wartość  to PNR - polecenie redysponowania."
                  enum: [ PNR ]
                redispatchOrderCode:
                  type: string
                  description: "Biznesowy kod polecenia redysponowania"
                  minLength: 20
                  maxLength: 20
                  examples:
                    - 1/I/22.07.2025
                redispatchOrderReason:
                  type: string
                  description: "Cel wydania polecenia redysponowania. Dopuszczalne wartości to B - polecenie bilansowe, S - polecenie sieciowe."
                  enum: [B, S]
        redispatchOrderPeriod:
          $ref: '#/components/schemas/RedispatchOrderPeriod'
        redispatchOrders:
          type: array
          minItems: 1
          description: "Dane wydanego polecenia redysponowania"
          items:
            $ref: '#/components/schemas/RedispatchOrderItem'

    RedispatchInformation:
      type: object
      additionalProperties: false
      required:
        - header
        - redispatchOrderPeriod
        - redispatchOrder
      properties:
        header:
          allOf:
            - $ref: '#/components/schemas/BaseHeader'
            - type: object
              required:
                - entityId
                - type
                - redispatchOrderCode
                - redispatchOrderReason
              properties:
                entityId:
                  type: string
                  description: Identyfikator podmiotu (Wytwórcy przyłączonego do Sieci Przesyłowej), który odpowiada za realizację polecenia redysponowania
                  minLength: 5
                  maxLength: 5
                type:
                  type: string
                  description: "Typ komunikatu. Dopuszczalna wartość słownikowa to INR - informacja o wydaniu polecenia redysponowania."
                  enum: [ INR ]
                redispatchOrderCode:
                  type: string
                  description: "Biznesowy kod polecenia redysponowania"
                  minLength: 20
                  maxLength: 20
                  examples:
                    - 1/I/22.07.2025
                redispatchOrderReason:
                  type: string
                  description: "Cel wydania polecenia redysponowania. Dopuszczalne wartości to B - polecenie bilansowe, S - polecenie sieciowe."
                  enum: [B, S]
        redispatchOrderPeriod:
          $ref: '#/components/schemas/RedispatchOrderPeriod'
        redispatchOrders:
          type: array
          minItems: 1
          description: "Dane wydanego polecenia redysponowania"
          items:
            $ref: '#/components/schemas/RedispatchOrderItem'

    RedispatchOrderItem:
      type: object
      additionalProperties: false
      required:
        - redispatchingObjectMrid
        - measurementUnit
        - curveType
        - seriesPeriods
      properties:
        redispatchingObjectMrid:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
          examples:
            - 5da114ac-a3ef-450d-a9db-d2208eb0ccc0
        measurementUnit:
          type: string
          description: "Jednostka danych. Dopuszczalna wartość to MAW - megawaty"
          enum: [ MAW ]
          minLength: 3
          maxLength: 3
        curveType:
          type: string
          description: "Typ krzywej. Określa sposób interpretacji wartości w podanych pozycjach. Dopuszczalna wartość to A01 - kolejne odcinki czasu; występują wszystkie punkty wg zadanej rozdzielczości."
          enum: [ A01 ]
          minLength: 3
          maxLength: 3
        seriesPeriods:
          type: array
          minItems: 1
          description: "Serie danych w punktach czasowych"
          items:
            type: object
            additionalProperties: false
            required:
              - direction
              - autogenerationRedispatch
              - resolution
              - timeInterval
              - seriesPoints
            properties:
              direction:
                type: string
                description: "Kierunek, którego dotyczy polecenie redysponowania. Dopuszczalne wartości to G - generacja, P - pobór"
                enum: [ G, P ]
              autogenerationRedispatch:
                type: string
                description: "Znacznik ograniczenia autogeneracji. Określa czy ograniczana jest moc generacji łącznie z mocą wytwarzaną na własne potrzeby i niewprowadzaną do sieci. Dotyczy tylko obiektów ze znacznikiem autogeneracja. Dla pozostałych zawsze wartość 0."
                enum: [ '0', '1' ]
              resolution:
                type: string
                description: "Rozdzielczość (ziarno). Dopuszczalne wartości to P1D - doba, PT60M - godzina, PT15M - kwadrans"
                enum: [ P1D, PT60M, PT15M ]
              timeInterval:
                type: object
                description: "Podokres danych wydanego polecenia redysponowania"
                additionalProperties: false
                required: [ startDt, endDt ]
                properties:
                  startDt:
                    type: string
                    format: date-time
                    description: "Początek podokresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss. Podawana w UTC z dokładnością do pełnych 15 minut (sekundy zostaną pominięte)"
                    pattern: 'Z$'
                    examples:
                      - 2023-09-24T12:00:00Z
                  endDt:
                    type: string
                    format: date-time
                    description: "Koniec podokresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss. Podawana w UTC z dokładnością do pełnych 15 minut (sekundy zostaną pominięte)"
                    pattern: 'Z$'
                    examples:
                      - 2023-09-24T14:30:00Z
              seriesPoints:
                type: array
                items:
                  type: object
                  description: "Dane w punktach czasowych"
                  additionalProperties: false
                  required: [ position, quantityMax, quantityMin ]
                  properties:
                    position:
                      type: integer
                      description: "Numer pozycji czasowej w odniesieniu do początku podokresu z uwzględnieniem podanej rozdzielczości"
                      minimum: 0
                      maximum: 999999
                    quantityMax:
                      type: number
                      description: "Wartość maksymalna ze względu na polecenie redysponowania"
                      minimum: 0
                      maximum: 99999.999
                      multipleOf: 0.001
                    quantityMin:
                      type: number
                      description: "Wartość minimalna ze względu na polecenie redysponowania"
                      minimum: 0
                      maximum: 99999.999
                      multipleOf: 0.001

    RedispatchOrderPeriod:
      type: object
      additionalProperties: false
      description: "Okres wydanego polecenia redysponowania"
      required: [ startDt, endDt ]
      properties:
        startDt:
          type: string
          format: date-time
          description: "Początek okresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss. Podawana w UTC z dokładnością do pełnych 15 minut (sekundy zostaną pominięte)"
          pattern: 'Z$'
          examples:
            - 2023-09-24T12:00:00Z
        endDt:
          type: string
          format: date-time
          description: "Koniec okresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss. Podawana w UTC z dokładnością do pełnych 15 minut (sekundy zostaną pominięte)"
          pattern: 'Z$'
          examples:
            - 2023-09-24T14:30:00Z

    RedispatchAcknowledgement:
      type: object
      description: "Odpowiedź na wydane polecenie redysponowania. Spodziewane są 2 dopowiedzi - najpierw RECEIVED a potem ACCEPTED/REJECTED "
      required:
        - header
        - acknowledgement
      properties:
        header:
          allOf:
            - $ref: '#/components/schemas/BaseHeader'
            - type: object
              required:
                - entityId
                - entityMsgId
                - redispatchOrderCode
              properties:
                entityId:
                  type: string
                  description: "Identyfikator podmiotu (OSDp), który odpowiada na wydane polecenie redysponowania. Identyfikator zgodny z bazą Partnerów Biznesowych PSE"
                  minLength: 5
                  maxLength: 5
                entityMsgId:
                  type: string
                  description: "Identyfikator komunikatu nadany przez nadawcę. Nadawca zapewnia jego unikalność"
                  format: uuid
                  examples:
                    - d0443a92-f807-45f0-867e-70cf5321dec7
                redispatchOrderCode:
                  type: string
                  description: "Biznesowy kod polecenia redysponowania"
                  minLength: 20
                  maxLength: 20
                  examples:
                    - 1/I/22.07.2025
        acknowledgement:
          type: object
          description: "Odpowiedź podmiotu na polecenie redysponowania"
          required:
            - status
          properties:
            status:
              type: string
              description: "Decyzja o realizacji wydanego polecenia redysponowania. Dopuszczalne wartości to RECEIVED - odebrano polecenia, ACCEPTED - potwierdzenie przyjęcia do realizacji polecenia redysponowania, REJECTED - informacja o odrzuceniu polecenia redysponowania."
              enum: [ RECEIVED, ACCEPTED, REJECTED ]
            reason:
              description: "Opis (krótki komentarz opisujący decyzję o realizacji polecenia redysponowania lub o odrzuceniu polecenia)"
              type: string
              maxLength: 512
    GenericFailure:
      type: object
      description: Generyczny komunikat o błędzie przetwarzania
      required:
        - header
      properties:
        header:
          additionalProperties: false
          required:
            - entityId
            - refMsgId
            - creationDateTime
          properties:
            entityId:
              type: string
              description: Identyfikator podmiotu, u którego wystąpił błąd przetwarzania
              minLength: 5
              maxLength: 5
            refMsgId:
              type: string
              description: Identyfikator komunikatu, który spowodował błąd
              format: uuid
              examples:
                - d0443a92-f807-45f0-867e-70cf5321dec7
            creationDateTime:
              type: string
              format: date-time
              description: "Data utworzenia komunikatu. Data i czas w formacie YYYY-MM-DDThh:mm:ss"
              pattern: 'Z$'
              examples:
                - 2002-09-24T12:21:47Z
        failureDetails:
          type: object 
          properties:          
            failureDateTime:
                type: string
                format: date-time
                description: "Data i czas w błędu przetwarzania"
                pattern: 'Z$'
                examples:
                  - 2002-09-24T12:21:47Z          
            failureDescription:
                type: string
                description: "Opis błedu"
            failedContent:
                type: object
                description: "Treść komunikatu, które spowodował błąd"
                additionalProperties: true
    
    PsdiRedispatchHeader:
      type: object
      additionalProperties: false
      required:
        - clientId
        - severMsgId
        - type
        - creationDateTime
        - stdVersion
      properties:
        clientId:
          type: string
          description: "Identyfikator podmiotu (OSDp, Wytwórcy przyłączonego do Sieci Przesyłowej), który odpowiada za realizację polecenia redysponowania. Identyfikator zgodny z bazą Partnerów Biznesowych PSE."
          minLength: 5
          maxLength: 5
        severMsgId:
          type: string
          description: "Identyfikator komunikatu nadawcy"
          format: uuid
          examples:
            - d0443a92-f807-45f0-867e-70cf5321dec7        
        creationDateTime:
          type: string
          format: date-time
          description: "Data utworzenia komunikatu. Data i czas w formacie YYYY-MM-DDThh:mm:ss"
          pattern: 'Z$'
          examples:
            - 2002-09-24T12:21:47Z
        stdVersion:
          type: string
          description: "Wersja standardów B2B"
          minLength: 3
          maxLength: 3
     
    PsdiMessageResult:
      type: object
      additionalProperties: false
      required:
        - header
        - status
      properties:
        header:
          $ref: '#/components/schemas/PsdiRedispatchHeader'
        status:
          type: string
          enum:
            - APPROVED
            - REJECTED
        validation:
          type: array
          items: 
            type: object
            properties:
              severity:
                type: string
                description: Stopień naruszenia walidacji powstałego w czasie przetwarzania
                enum:
                  - INFO
                  - WARN
                  - ERROR
                example: WARN
              code:
                type: string
                description: Kod naruszenia walidacji powstałego w czasie przetwarzania
                maxLength: 10
                example: 
              field:
                type: string
                description: wskazanie na element w zgłoszeniu
                example: 
              message:
                type: string
                description: Opis naruszenia walidacji powstałego w czasie przetwarzania
                example:     

    PsdiRedispatch:
      type: object
      description: "Komunikat informujący o wydanym przez OSP poleceniu redysponowania"
      required:
        - mRID
        - redispatchTable
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"  
        redispatchTable:
          type: array
          items: 
            $ref: '#/components/schemas/PsdiRedispatchTable'

    PsdiRedispatchRealization:
      type: object
      description: "Komunikat informujący o wydanym przez OSD poleceniu redysponowania"
      required:
        - mRID
        - redispatchDate
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
        redispatchDate:
          type: string
          format: date
          description: "Doba redysponowania w formacie YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-02
        redispatchDetail:
          type: array
          items: 
            $ref: '#/components/schemas/PsdiRedispatchRealizationTable'

    PsdiUOze:
      type: object
      description: "Komunikat informujący o Przekazanie informacji o zgłoszeniach wynikających z art. 93 ust. 18 Ustawy o OZE, , które złożyli Wytwórcy w aplikacji WOZE po wydanym poleceniu przez OSP"
      required:
        - mRID
        - redispatchDate
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
        redispatchDate:
          type: string
          format: date
          description: "Doba redysponowania w formacie YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-02
        notificationDate:
          type: string
          format: date
          description: "Data kiedy OSD został poinformowany o tym czy i jaka część zredukowanej energii powinna zostać rozliczona w danym systemie wsparcia YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-03
        supportingSystem:
          type: string
          description: "Systemie wsparcia w jakim powinna zostać rozliczona energia"
          enum:
            - auction
            - greenCertificate
        energy:
          type: integer
          description: "% zredukowanej energii, która powinna zostać rozliczona w danym systemie wsparcia (art. 93 ust. 18 ustawy o odnawialnych źródłach energii (Dz.U.2023.1436))"
        ipaNumber:
          type: string
          description: "numer IPA, którego dotyczy system wsparcia"

    PsdiPOB:
      type: object
      description: "Komunikat informujący o zmianie przypisania POB do pojedynczego MWE"
      required:
        - mRID
        - redispatchDate
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
        pobName:
          type: string          
          description: "Nazwa podmiotu odpowiedzialnego za bilansowanie"
          maxLength: 256
        pobNIP:
          type: string          
          description: "NIP podmiotu odpowiedzialnego za bilansowanie"
          maxLength: 10
          examples:
            - '1234567890'
        pobDate:
          type: string
          format: date
          description: "Data od kiedy POB pełni funkcję dla MWE YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-02        

    PsdiEWykCert:
      type: object
      description: "Komunikat informujący o E_wyk_cert dla MWE, które były redysponowane przez OSD w związku z wydanym poleceniem OSP"
      required:
        - mRID
        - redispatchDate
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
        redispatchDate:
          type: string
          format: date
          description: "Doba redysponowania w formacie YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-02
        eWykCertTable:
          type: array
          items: 
            $ref: '#/components/schemas/PsdiEWykCertTable'
        eWykCertTableTimeChange:
          type: array
          description: "Wartości e-wyk-cert dla dodatkowej godziny przy zmianie czasu dla godzin 2:15, 2:30, 2:45, 3:00"
          items: 
            $ref: '#/components/schemas/PsdiEWykCertTable'

    PsdiRestrictions:
      type: object
      description: "Komunikat informujący o ograniczeniach w sieci OSD nie będących efektem wydanego przez OSP polecenia redysponowania"
      required:
        - mRID
        - redispatchDate
      properties:
        mRID:
          type: string
          format: uuid
          description: "mRID obiektu redysponowania"
        redispatchDate:
          type: string
          format: date
          description: "Doba redysponowania w formacie YYYY-MM-DD"
          pattern: 'Z$'
          examples:
            - 2025-11-02
        redispatchTable:
          type: array
          items: 
            $ref: '#/components/schemas/PsdiRestrictionTable'
        redispatchTableTimeChange:
          type: array
          description: "Wartości P_zad_osd dla dodatkowej godziny przy zmianie czasu dla godzin 2:15, 2:30, 2:45, 3:00"
          items: 
            $ref: '#/components/schemas/PsdiRestrictionTable'

    PsdiRedispatchTable:
      type: object
      description: "Tabela przedziałów czasowych polecenia redysponowania"
      properties:
        seriesPeriod:
          type: array
          minItems: 1
          description: "Serie danych w punktach czasowych"
          items:
            type: object
            additionalProperties: false
            required:
              - resolution
              - timeInterval
              - seriesPoints
            properties:
              resolution:
                type: string
                description: "Rozdzielczość (ziarno)"
                enum: [PT15M]
              timeInterval:
                type: object
                description: "Podokres danych wydanego polecenia redysponowania"
                additionalProperties: false
                required: [start, end]
                properties:
                  start:
                    type: string
                    format: date-time
                    description: "Początek podokresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss"
                    pattern: 'Z$'
                    examples:
                          - 2023-09-24T12:00:00Z
                  end:
                    type: string
                    format: date-time
                    description: "Koniec podokresu. Data i czas w formacie YYYY-MM-DDThh:mm:ss"
                    pattern: 'Z$'
                    examples:
                          - 2023-09-24T14:30:00Z
              seriesPoints:
                type: array                    
                description: "Dane w punktach czasowych"
                additionalProperties: false
                items:
                  type: object
                  required: [position, pZad, redispatchType]
                  properties:
                    position:
                      type: integer
                      description: "Pozycja"
                      minimum: 0
                      maximum: 999999
                    pZad:
                      type: number
                      description: "Zadany przez OSP maksymalny poziom dopuszczalenej generacji mocy czynnej w miejscu przyłączenia instalacji fotowoltaicznej do sieci OSD, wyrażony w kW z dokładnością do 1 kW"
                      minimum: 0
                      maximum: 999999
                      multipleOf: 1
                    redispatchType:
                      type: string
                      description: "Typ polecenia, B - bilansowe, S - sieciowe"
                      enum:
                          - B
                          - S
                      example: "B"

    PsdiRedispatchRealizationTable:
      type: object
      description: "Tabela przedziałów czasowych polecenia redysponowania"
      required:
        - redispatchTimeBegin
        - redispatchTimeEnd
        - pZad
        - redispatchType
      properties:
        redispatchTimeBegin:
          type: string
          format: date-time
          description: "Czas rozpoczęcia redyspozycji w formacie YYYY-MM-DDThh:mm:ss"
          pattern: 'Z$'
          example: "2019-08-24T14:15:22Z"
        redispatchTimeEnd:
          type: string
          format: date-time
          description: "Czas zakończenia redyspozycji w formacie YYYY-MM-DDThh:mm:ss"
          pattern: 'Z$'
          example: "2019-08-24T14:15:22Z"
        pZad:
          type: number
          format: float
          description: Wartość zadanej mocy (P_zad) w MW.
          example: 0
        redispatchType:
          type: string
          description: Typ redyspozycji (np. bilansowe, awaryjne).
          enum:
            - bilansowe
            - awaryjne
          example: "bilansowe"  

    PsdiEWykCertTable:
      type: object
      description: "Tabela przedziałów czasowych e-wyk-cert"
      required:
        - dateTimeEnd        
        - pZad        
      properties:        
        dateTimeEnd:
          type: string
          format: date-time
          description: "Koniec 15 minutowego przedziału"
          pattern: 'Z$'
          example: "2019-08-24T14:15:00"
        eWykCert:
          type: number
          format: float
          description: "Wolumenie energii wyprodukowanej przez instalację wiatrową w przedziale czasowym t, zmierzony na zaciskach generatorów turbin wiatrowych, wyrażony z kWh z dokładnością do 2 miejsc po przecinku. W zależności od dokładności urządzeń pomiarowych do przedziału t oznaczonego 00:15:00 może zostać zakwalifikowany pomiar od 00:00:01 do 00:15:00 albo od 00:00:01 do 00:14:59 albo inny obejmujący w maksymalnym zakresie ten przedział"
          example: 12.22

    PsdiRestrictionTable:    
      type: object
      description: "Tabela przedziałów czasowych polecenia redysponowania"
      required:
        - dateTimeEnd        
        - pZad        
      properties:        
        dateTimeEnd:
          type: string
          format: date-time
          description: "Koniec 15 minutowego przedziału"
          pattern: 'Z$'
          example: "2019-08-24T14:15:00"
        pZad:
          type: number
          format: float
          description: "Maksymalny poziom generacji mocy czynnej instalacji fotowoltaicznej zdeterminowany przyczynami innymi niż wydane przez OSP polecenie Redysponowania Nierynkowego, w poszczególnych przedziałach czasowych, wyrażony w kW z dokładnością do 1 kW"
          example: 0
    
  securitySchemes:
    oauth2:
      type: oauth2
      description: OAuth2 dla publikacji komunikatów
      flows:
        clientCredentials:
          tokenUrl: https://auth.example.com/oauth2/token
          refreshUrl: https://auth.example.com/oauth2/refresh
          availableScopes:
            "rabbitmq.read:*/redispatch/redispatch.order.{sub}": "Uprawnienie do odbioru komunikatów polecenia redysponowania z dedykowanej kolejki"
            "rabbitmq.write:*/redispatch/redispatch.acknowledgement": "Uprawnienie pozwala wysyłać odpowiedź na wydane polecenie redysponowania."
            "rabbitmq.read:*/redispatch/redispatch.information.{sub}": "Uprawnienie do odbioru informacji o poleceniu redysponowania z dedykowanej kolejki"
            "rabbitmq.write:*/redispatch/failure": "Uprawnienie pozwala wysyłać błędy spowodowane komunikatami OSP polecenie redysponowania."
            "rabbitmq.read:*/redispatch/failure.{sub}": "Uprawnienie pozwala wysyłać odpowiedź na wydane polecenie redysponowania."            
            